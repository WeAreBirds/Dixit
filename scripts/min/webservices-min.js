"use strict";app.webservices={prefix:"https://dixit.bnpparibasfortis.be/restapi/",version:"V3",newsPosition:3,articlesPageSize:10,cacheExpiration:5,events:[],init:function(){app.storage.getItem("userInfo",function(e){e?(app.cache.setIsUserLogged(!0),$.ajaxSetup({data:{isMobile:!0,UserId:JSON.parse(e).userId,UserPassword:JSON.parse(e).userPassword}})):(app.cache.setIsUserLogged(!1),$.ajaxSetup({data:{isMobile:!0}}))})},getRequestHash:function(){var e=arguments[0];return arguments.length>1&&(e+=JSON.stringify(arguments[1])),murmurhash3_32_gc(e)},getCachedJSON:function(){var e=this.getRequestHash.apply(this,arguments),t=lscache.get("json_"+e);return this.getJSON.apply(this,arguments).then(function(t){return lscache.set("json_"+e,t,app.webservices.cacheExpiration),t})},getJSON:function(){var e=this,t=arguments,s=$.Deferred();return function r(){$.getJSON.apply(this,t).done(s.resolve).fail(function(){r(this)})}(),s.promise()},post:function(){var e=this,t=arguments,s=$.Deferred();return function r(){$.post.apply(this,t).done(s.resolve).fail(function(){r(this)})}(),s.promise()},getArticlesCategories:function(){return this.getCachedJSON(this.prefix+"article/"+this.version+"/"+app.translations.selectedLanguage+"/categories").then(function(e){return app.dataTransformer.categories(e.SearchResults.ListCategories)})},getProfessionCategories:function(){return this.getCachedJSON(this.prefix+"article/"+this.version+"/"+app.translations.selectedLanguage+"/works").then(function(e){return app.dataTransformer.professionCategories(e.SearchResults.ListWorks)})},getTopArticles:function(e,t){var s={IndexName:"article-search",Skip:0,Take:4,TopArticles:!0};return e&&(s.Take=1,t?s.searchWorks=e:s.CategoryId=e),this.getCachedJSON(this.prefix+"article/"+this.version+"/"+app.translations.selectedLanguage+"/search",s).then(function(e){return 206==e.ResultCode&&app.webservices.userExpired(),app.dataTransformer.topArticles(e.SearchResults.ListArticles)})},searchArticles:function(e,t){var s={IndexName:"article-search",Skip:t,Take:this.articlesPageSize,Keyword:e};return this.getCachedJSON(this.prefix+"article/"+this.version+"/"+app.translations.selectedLanguage+"/search",s).then(function(e){return 206==e.ResultCode&&app.webservices.userExpired(),app.dataTransformer.articles(e.SearchResults.ListArticles)})},searchArticlesByTag:function(e,t){var s={IndexName:"article-search",Skip:t,Take:this.articlesPageSize,selectedTag:e};return this.getCachedJSON(this.prefix+"article/"+this.version+"/"+app.translations.selectedLanguage+"/search",s).then(function(e){return 206==e.ResultCode&&app.webservices.userExpired(),app.dataTransformer.articles(e.SearchResults.ListArticles)})},getArticles:function(e,t,s){var r={IndexName:"article-search",Skip:t,Take:this.articlesPageSize,ExcludeTops:!0};return e&&(s?r.searchWorks=e:r.CategoryId=e),this.getCachedJSON(this.prefix+"article/"+this.version+"/"+app.translations.selectedLanguage+"/search",r).then(function(e){return 206==e.ResultCode&&app.webservices.userExpired(),app.dataTransformer.articles(e.SearchResults.ListArticles)})},getArticle:function(e){var t=$.Deferred(),s={ArticleId:e};return this.getCachedJSON(this.prefix+"article/"+this.version+"/"+app.translations.selectedLanguage+"/detail",s).then(function(e){206==e.ResultCode&&app.webservices.userExpired(),app.dataTransformer.article(e.SearchResult.Article).then(function(e){t.resolve(e)})}),t},getComments:function(e){var t=$.Deferred(),s={IndexName:"comment-search",ArticleId:e};return this.getCachedJSON(this.prefix+"article/"+this.version+"/"+app.translations.selectedLanguage+"/comment",s).then(function(e){return app.dataTransformer.comments(e.SearchResults.ListComments)})},getRelatedArticles:function(e){var t={IndexName:"article-search",ArticleId:e,Skip:0,Take:3};return this.getCachedJSON(this.prefix+"article/"+this.version+"/"+app.translations.selectedLanguage+"/related",t).then(function(e){return 206==e.ResultCode&&app.webservices.userExpired(),app.dataTransformer.relatedArticles(e.SearchResults.ListArticles)})},getLastVideoArticles:function(){var e={IndexName:"article-search",ArticleTypes:1};return this.getCachedJSON(this.prefix+"article/"+this.version+"/"+app.translations.selectedLanguage+"/search",e).then(function(e){return 206==e.ResultCode&&app.webservices.userExpired(),app.dataTransformer.articles(e.SearchResults.ListArticles)})},getEvents:function(e,t){var s={Year:e,Month:t,Skip:0,Take:0};return this.getCachedJSON(this.prefix+"event/"+this.version+"/"+app.translations.selectedLanguage+"/filter",s).then(function(e){return 206==e.ResultCode&&app.webservices.userExpired(),app.webservices.events=app.dataTransformer.events(e.SearchResults.ListEvents),app.webservices.events})},getEvent:function(e){for(var t=null,s=$.Deferred(),r=0;r<app.webservices.events.length;r++)if(app.webservices.events[r].id==e){t=app.dataTransformer.event($.extend(!0,{},app.webservices.events[r]));break}return s.resolve(t)},likeArticle:function(e){var t=this,s={ArticleId:e};return this.getJSON(this.prefix+"article/"+this.version+"/articleLike",s).done(function(){app.storage.getItem("likes",function(s){s=null===s?[]:JSON.parse(s),s.push(e),app.storage.setItem("likes",JSON.stringify(s));for(var r=0;r<app.translations.supportedLanguages.length;r++){lscache.setBucket(app.translations.supportedLanguages[r]);var a=t.getRequestHash(t.prefix+"article/"+t.version+"/"+app.translations.supportedLanguages[r]+"/detail",{ArticleId:e});lscache.remove("json_"+a)}lscache.setBucket(app.translations.selectedLanguage)})})},answerSurvey:function(e,t,s){var r=this,a={SurveyId:t,AnswerId:s};return this.getJSON(this.prefix+"article/"+this.version+"/survey",a).done(function(){app.storage.getItem("surveys",function(s){s=null===s?[]:JSON.parse(s),s.push(t),app.storage.setItem("surveys",JSON.stringify(s));for(var a=0;a<app.translations.supportedLanguages.length;a++){lscache.setBucket(app.translations.supportedLanguages[a]);var i=r.getRequestHash(r.prefix+"article/"+r.version+"/"+app.translations.supportedLanguages[a]+"/detail",{ArticleId:e});lscache.remove("json_"+i)}lscache.setBucket(app.translations.selectedLanguage),app.analytics.trackEvent("Survey","Answer",t)})})},saveComment:function(e,t,s,r,a,i){var n={ArticleId:e,ArticleName:t,CommentName:s,CommentEmail:r,CommentMessage:a,RelatedCommentId:i};return this.post(this.prefix+"article/"+this.version+"/"+app.translations.selectedLanguage+"/comment?format=json",n).done(function(){})},createUser:function(e){var t={Email:e};return this.post(this.prefix+"user/"+this.version+"/"+app.translations.selectedLanguage+"/create?format=json",t).done(function(){})},validateUser:function(e,t){var s={UserId:e,UserPassword:t};return this.post(this.prefix+"user/"+this.version+"/"+app.translations.selectedLanguage+"/validate?format=json",s).done(function(){var s={userId:e,userPassword:t};app.storage.setItem("userInfo",JSON.stringify(s)),lscache.set("refreshData",!0),app.webservices.init()})},userValidationDate:function(e,t){return this.post(this.prefix+"user/"+this.version+"/"+app.translations.selectedLanguage+"/validationDate?format=json").done(function(){})},userExpired:function(){app.storage.getItem("userInfo",function(e){e&&(alert(app.translations.texts.sessionExpired),app.storage.removeItem("userInfo",function(){app.webservices.init(),app.cache.setIsUserLogged(!1)}))}),lscache.flush(),lscache.set("refreshData",!0)}};