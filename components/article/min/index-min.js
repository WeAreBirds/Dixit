"use strict";app.articleView=kendo.observable({article:{id:null,image:"",gallery:[]},relatedArticles:[],swiperGallery:null,onInit:function(){app.articleView.set("translations",app.translations),app.articleView.translations.bind("change",function(e){"selectedLanguage"==e.field&&(app.articleView.article={id:null,image:""})}),$(document).on("click","#articleView .card",function(e){e.preventDefault(),app.mobileApp.replace("components/article/view.html?id="+$(e.currentTarget).data("id"),"slide")}),$("#sendComment").on("click",function(e){e.preventDefault(),app.mobileApp.showLoading();var a=app.articleView.article.id,i=app.articleView.article.title,t=$("#commentName").val(),n=$("#commentEmail").val(),l=$("#commentMessage").val();a&&t&&n&&l?app.webservices.saveComment(a,i,t,n,l,"").done(function(e){200==e.ResultCode?($(".confirmPopup").fadeIn(),setTimeout(function(){$(".confirmPopup").fadeOut()},1500),$("#commentName, #commentEmail, #commentMessage").val("")):alert(app.translations.texts.error)}).always(function(){app.mobileApp.hideLoading()}):(app.mobileApp.hideLoading(),$(".errorPopup").fadeIn(),setTimeout(function(){$(".errorPopup").fadeOut()},2e3))})},onShow:function(e){if(e.view.scroller.reset(),e.view.params.id!=app.articleView.article.id){null!==app.articleView.swiperGallery&&app.articleView.swiperGallery.destroy&&(app.articleView.swiperGallery.destroy(!0,!0),app.articleView.swiperGallery=null);var a=$("#articleView").find("[data-role=content],[data-role=footer]");a.css("visibility","hidden"),app.mobileApp.showLoading(),app.webservices.getArticle(e.view.params.id).done(function(e){app.webservices.getComments(e.id).done(function(e){app.articleView.set("comments",e),$("*[id=replyComment]").on("click",function(e){var a=$(this).closest("div").attr("id");$(".answerLink[data-comment-id="+a+"]").hide(),$("#reply-"+a).show(),$("#sendComment-"+a).on("click",function(e){e.preventDefault();var i=app.articleView.article.id,t=app.articleView.article.title,n=$("#commentName-"+a).val(),l=$("#commentMail-"+a).val(),r=$("#commentMessage-"+a).val(),p=a;i&&n&&l&&r&&p?app.webservices.saveComment(i,t,n,l,r,p).done(function(e){200==e.ResultCode?($("#reply-"+a).hide(),$("#sendCommentConfirm-"+a).fadeIn(),setTimeout(function(){$("#sendCommentConfirm-"+a).fadeOut()},1500),$(".answerLink[data-comment-id="+a+"]").show()):alert(app.translations.texts.error)}).always(function(){app.mobileApp.hideLoading()}):(app.mobileApp.hideLoading(),$(".errorPopup").fadeIn(),setTimeout(function(){$(".errorPopup").fadeOut()},1500))})})}).always(function(){app.mobileApp.hideLoading()}),app.cache.setArticleDetailUrl(e.url),app.articleView.set("article",e),a.css("visibility",""),app.webservices.getRelatedArticles(e.id).done(function(e){app.articleView.set("relatedArticles",e),app.articleView.set("hasRelatedArticles",e.length>0)}),app.analytics.trackPage("Article : "+app.articleView.article.analyticTitle)}).always(function(){app.mobileApp.hideLoading()})}else app.analytics.trackPage("Article : "+app.articleView.article.analyticTitle)},like:function(e){e.preventDefault(),e.stopPropagation();var a=$(e.currentTarget);a.hasClass("active")||(app.mobileApp.showLoading(),app.analytics.trackEvent("User Action","Like",a.data("analytic-title")),app.webservices.likeArticle(a.attr("data-id")).done(function(){a.addClass("active");var e=a.find("span");e.text(parseInt(e.text())+1)}).always(function(){app.mobileApp.hideLoading()}))},answer:function(e){e.preventDefault(),e.stopPropagation();var a=$(e.currentTarget);app.mobileApp.showLoading(),app.webservices.answerSurvey(a.data("article-id"),a.data("id"),a.val()).done(function(){app.articleView.set("article.showSurveyAnswers",!1),app.articleView.set("article.showSurvey",!0)}).always(function(){app.mobileApp.hideLoading()})},onGalleryLoaded:function(){this.swiperGallery=new Swiper("#articleView .swiper-container",{loop:!0})},videoFullscreen:function(){var e=$(".article-video iframe");e.setAttribute("allowfullscreen")}});